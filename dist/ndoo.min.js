!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("_"),require("jQuery"),require("Zepto"),require("Backbone")):"function"==typeof define&&define.amd?define(["_","jQuery","Zepto","Backbone"],e):"object"==typeof exports?exports.ndoo=e(require("_"),require("jQuery"),require("Zepto"),require("Backbone")):t.ndoo=e(t._,t.jQuery,t.Zepto,t.Backbone)}(this,function(t,e,n,i){return function(t){function e(i){if(n[i])return n[i].exports;var r=n[i]={exports:{},id:i,loaded:!1};return t[i].call(r.exports,r,r.exports,e),r.loaded=!0,r.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){t.exports=n(1)},function(t,e,n){"use strict";var i=n(2);t.exports=new i.Ndoo},function(t,e,n){"use strict";var i=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},r=n(3),o=n(7),a=n(8),s=n(9),c=n(6),l=n(16),u=c.getPrepData(),p=function(t){function e(){t.call(this),this._lib=s._lib,this.pageId="",this._pk=+new Date,this.storage=o.Storage,this.router=a.Router,this._loader={app:"do",block:"do",init:"do",appLoader:null,blockLoader:null,initLoader:null,doLoader:function(t,e){Do.apply(null,t.concat(e))},seajsLoader:function(t,e){seajs.use(t,e)}},this._blockData={_block:{},_app:{},_service:{},_exist:{}},this.RegType=l.RegType,this.Component=l.getComponent(this),this.storage._lib=this._lib,this._rebuildEvent(),this.event.init(),this.trigger("STATUS:NAPP_DEFINE"),this.trigger("STATUS:NBLOCK_DEFINE"),this.trigger("STATUS:NSERVICE_DEFINE"),this._bindBlockEvent(),u&&c.removePrepData()}return i(e,t),e.prototype.initPageId=function(t){if(!this.pageId&&"undefined"!=typeof document){var e=document.getElementById(t||"scriptArea");e&&(this.pageId=e.getAttribute("data-page-id")||""),!this.pageId&&t&&(this.pageId=t)}},e.prototype.getPk=function(t){return void 0===t&&(t=""),""+t+ ++this._pk},e.prototype.setLoader=function(t,e){this._loader[t]=t+"Loader",this._loader[t+"Loader"]=e},e.prototype.require=function(t,e,n){if(n=n.toLowerCase(),!this._loader[n+"Loader"])throw new Error("require load is not define");this[n](t,e)},e.prototype._block=function(t,e,n,i){var r,o;if("block"!=t&&"app"!=t&&"service"!=t)return!1;r=this._blockData["_"+t],o=e?e.replace(/^[\/.]|[\/.]$/g,"").split(/[\/.]/):[];var a,s,c=r;if(i||arguments.length>3){for(var l=0,u=o;l<u.length;l++){var p=u[l];c=c[p]||(c[p]={})}return!i||"app"!==t&&"block"!==t?"service"==t?(a=c[n]=i,s=!0):a=!1:a="object"==typeof i?"app"===t&&c[n]?this._lib.defaults(c[n],i):c[n]=i:"function"==typeof i&&(c[n]=i),(a||s)&&(e?this._blockData._exist[t+"."+e+"."+n]=!0:this._blockData._exist[t+"."+n]=!0),a}for(var f=0,d=o;f<d.length;f++){var h=d[f];if(!this._lib.has(c,h))return;c=c[h]}return c[n]},e.prototype.hasApp=function(t){return this._blockData._exist["app."+t]},e.prototype.setApp=function(t){return this._blockData._exist["app."+t]=!0},e.prototype.app=function(t,e){var n,i=t.match(/(.*?)(?:[\/.]([^\/.]+))$/);return i||(i=[,null,t]),t=i[1],n=i[2],arguments.length>1?this._block("app",t,n,e):this._block("app",t,n)},e.prototype._blockExist=function(t,e){void 0===e&&(e=!1);var n,i=t.match(/(.*?)(?:[\/.]([^\/.]+))$/);return i||(i=[,"_default",t]),t=i[1],n=i[2],e?this._blockData._exist["block."+t+"."+n]=!0:this._blockData._exist["block."+t+"."+n]},e.prototype.hasBlock=function(t){return this._blockExist(t)},e.prototype.setBlock=function(t){return this._blockExist(t,!0)},e.prototype.block=function(t,e){var n,i=t.match(/(.*?)(?:[\/.]([^\/.]+))$/);return i||(i=[,"default",t]),t=i[0],n=i[1],arguments.length>1?this._block("block",t,n,e):this._block("block",t,n)},e.prototype.initBlock=function(t){var e=this,n=this,i=n._lib,r=n.router,o=i.data(t,"nblockId");o=o.split(/\s*,\s*|\s+/);var a=function(n){r.parse(/^(?:\/?)(.*?)(?:\/?([^\/?#]+))(?:\?(.*?))?(?:\#(.*?))?$/,n,function(n,i,r){n=n.replace(/\//g,".");var o=n+"."+i;e.block(o)?e.trigger("NBLOCK_LOADED",t,n,i,r):e.hasBlock(o)&&e.require([n+"."+i],function(){e.trigger("NBLOCK_LOADED",t,n,i,r)},e._loader.block)})};i.each(o,function(t){var n=e;a.call(n,t)})},e.prototype._bindBlockEvent=function(){var t=this;this.on("NBLOCK_LOADED",function(e,n,i,r){null==n&&(n="_default");var o=t.block(n+"."+i);if(o)if(t._lib.isFunction(o.init)){var a=function(){o.init(e,r)};o.depend?t.require([].concat(o.depend),a,t._loader.block):a()}else t._lib.isFunction(o)&&o(e,r)}),this.on("NBLOCK_INIT",function(){var e=t._lib.querySelector("[data-nblock-id]");if(e&&e.length){for(var n=[],i=0,r=e;i<r.length;i++){var o=r[i],a=t._lib.data(o,"nblockAuto"),s=parseInt(t._lib.data(o,"nblockLevel"))||5;n.push([s,a,o])}n=n.sort(function(t,e){return t[0]-e[0]});for(var c=0,l=n;c<l.length;c++){var u=l[c],a=u[1],p=u[2];void 0!==a&&"false"==a.toString()||t.initBlock(p)}}})},e.prototype.service=function(t,e){var n,i=t.match(/(.*?)(?:[\/.]([^\/.]+))$/);return i||(i=[,"_default",t]),t=i[1],n=i[2],arguments.length>1?this._block("service",t,n,e):(e=this._block("service",t,n),e&&this._lib.isFunction(e.init)?e.init():e)},e.prototype.dispatch=function(){var t=this,e=this._lib,n=function(e,n,i,r){var o,a=t._lib;if("before"===e?o=n.before:"after"===e&&(o=n.after),o){var s;"object"==typeof o&&(s=[].concat(o));for(var c=0,l=s;c<l.length;c++){var u=l[c],p=u.filter;a.isArray(p)||(p=[].concat(p.split(/\s*,\s*|\s+/)));var f=!0;if(u.only){var d=u.only;a.isArray(d)||(d=[].concat(d.split(/\s*,\s*|\s+/))),a.indexOf(d,i)<0&&(f=!1)}else if(u.except){var h=u.except;a.isArray(h)||(h=[].concat(h.split(/\s*,\s*|\s+/))),a.indexOf(h,i)>-1&&(f=!1)}if(f)for(var v=0,_=p;v<_.length;v++){var g=_[v];n[g+"Filter"](i,r)}}}};this.on("NAPP_ACTION_BEFORE",function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];return n.apply(null,["before"].concat(t))}),this.on("NAPP_ACTION_AFTER",function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];return n.apply(null,["after"].concat(t))}),this.on("NAPP_LOADED",function(n,i,r,o){var a,s=t;a=n?t.app(n+"."+i):t.app(i),!e.has(a,r+"Action")&&e.has(a,"emptyAction")&&(r="_empty");var c=[];a.depend&&(c=c.concat(a.depend)),a[r+"Depend"]&&(c=c.concat(a[r+"Depend"]));var l=i;n&&(l=(n+"."+i).replace(/\./g,"_")),l=l.toUpperCase();var u=function(){var t=[].slice.call(arguments,0);t.unshift(o),r&&(s.trigger("NAPP_ACTION_BEFORE",a,r,o),s.trigger("NAPP_"+l+"_ACTION_BEFORE",a,r,o),a[r+"Before"]&&a[r+"Before"].apply(a,t),a[r+"Action"]&&a[r+"Action"].apply(a,t),a[r+"After"]&&a[r+"After"].apply(a,t),s.trigger("NAPP_"+l+"_ACTION_AFTER",a,r,o),s.trigger("NAPP_ACTION_AFTER",a,r,o)),s.trigger("STATUS:NBLOCK_INIT")};c.length?t.require(e.uniq(c),u,t._loader.app):u()}),this.on("PAGE_STATUS_ROUTING",function(e){t.router.parse(/^(?:\/?)(.*?)(?:\/?([^\/?#]+))(?:\?(.*?))?(?:\#(.*?))?$/,e,function(e,n,i){var r=e.match(/(.*?)(?:[\/.]([^\/.]+))$/),o="";r&&(o=r[1],e=r[2]);var a;o?(o=o.replace(/\//g,"."),a=o+"."+e):a=e,t.app(a)?t.trigger("NAPP_LOADED",o,e,n,i):t.hasApp(a)?t.require([a],function(){this.trigger("NAPP_LOADED",o,e,n,i)},t._loader.app):t.trigger("STATUS:NBLOCK_INIT")})})},e.prototype.triggerPageStatus=function(t){var e=this,n=this._lib,i=function(){e.trigger("STATUS:PAGE_STATUS_FAST"),n.onready(function(){e.trigger("STATUS:PAGE_STATUS_DOMPREP"),e.trigger("STATUS:PAGE_STATUS_DOM"),e.trigger("STATUS:PAGE_STATUS_DOMORLOAD")}),n.onload(function(){e.trigger("STATUS:PAGE_STATUS_LOAD")}),e.on("PAGE_STATUS_DOM",function(){e.pageId&&e.trigger("STATUS:PAGE_STATUS_ROUTING",e.pageId)})};t?this.require([].concat(t),i,this._loader.init):i()},e.prototype.init=function(t,e){var n=this._lib;return n.isArray(t)&&(i=["",t],t=i[0],e=i[1]),this.initPageId(t),this.dispatch(),this.triggerPageStatus(e),this;var i},e.prototype._rebuildEvent=function(){var t=this._lib,e=t.extend({events:{},listened:{}},t.Events);this.event=t.extend(this.event,{eventHandle:e,on:function(e,n){var i=this.eventHandle;if(i.on(e,n),i.listened[e]=!0,t.has(i.events,"STATUS:"+e)&&n.apply(i,i.events["STATUS:"+e]),t.has(i.events,e))for(var r=0,o=i.events[e];r<o.length;r++){var a=o[r];n.apply(i,a)}},trigger:function(e,n,i){var r=this.eventHandle;"DEFAULT"===n?r.trigger.apply(r,[e].concat(i)):"DELAY"===n?(t.has(r.listened,e)&&r.trigger.apply(r,[e].concat(i)),t.has(r.events,e)||(r.events[e]=[]),r.events[e].push(i)):"STATUS"===n&&(t.has(r.events,n+":"+e)||(r.events[n+":"+e]=i,t.has(r.listened,e)&&r.trigger.apply(r,[e].concat(i))))},off:function(t){var e=this.eventHandle;e.off(t),delete e.listened[t],delete e.events[t]},init:function(){var t=this,e=t.inited,n=t._temp,i=t.TYPE_ON,r=t.TYPE_TRIGGER;if(!e&&n.length){for(var o=0,a=n;o<a.length;o++){var s=a[o];s.type===i?this.on(s.eventName,s.callback):s.type===r&&this.trigger(s.eventName,s.eventTYpe,s.data)}e=!0}}})},e}(r.Prep);e.Ndoo=p},function(t,e,n){"use strict";var i=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},r=n(4),o=n(5),a=n(6),s=a.getPrepData(),c=function(t){function e(){t.call(this),this._isDebug=!1,this.event=o.EventBasic,this.vars={},this.func={},this._lib={},s&&(this.vars=s.vars,this.func=s.func)}return i(e,t),e}(r.EventApi);e.Prep=c},function(t,e){"use strict";var n=function(){function t(){}return t.prototype.on=function(t,e){t=t.split(/\s*,\s*|\s+/);for(var n=0,i=t;n<i.length;n++){var r=i[n];this.event.on(r,e)}},t.prototype.trigger=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var i=t.indexOf(":"),r=t.substring(0,i++)||"DEFAULT",o=t.substring(i);this.event.trigger(o,r,e)},t.prototype.off=function(t){t=t.split(/\s*,\s*|\s+/);for(var e=0,n=t;e<n.length;e++){var i=n[e];this.event.off(i)}},t}();e.EventApi=n},function(t,e,n){"use strict";var i=n(6),r=i.getPrepData(),o=function(){function t(t,e){return"#"+t+":#"+e}return t.on=function(t,e){this._temp.push({type:this.TYPE_ON,eventName:t,callback:e})},t.trigger=function(t,e,n){this._temp.push({type:this.TYPE_TRIGGER,eventName:t,eventType:e,data:n})},t.off=function(t){},t.init=function(){},t.TYPE_ON=1,t.TYPE_TRIGGER=2,t.inited=!1,t._temp=r?r.eventData:[],t}();e.EventBasic=o},function(t,e){"use strict";e.getPrepData=function(){return!("undefined"==typeof window||!window.ndoo_prep_data)&&window.ndoo_prep_data},e.setPrepData=function(){var t={};"undefined"!=typeof window&&(t=window),t.ndoo_prep_data||(t.ndoo_prep_data={eventData:[],func:{},vars:{}})},e.removePrepData=function(){"undefined"!=typeof window&&window.ndoo_prep_data&&delete window.ndoo_prep_data}},function(t,e){"use strict";var n=function(){function t(e,n,i){var r=t,o=i&r.DESTROY,a=i&r.REWRITE,s=r._data;return void 0===n?s[e]:o?(delete s[e],!0):!(!a&&r._lib.has(s,e))&&(s[e]=n)}return t._data={},t.REWRITE=1,t.DESTROY=2,t}();e.Storage=n},function(t,e){"use strict";var n=function(){function t(){}return t.parse=function(t,e,n){var i=t.exec(e);null!=i&&n.apply(null,i.slice(1))},t}();e.Router=n},function(t,e,n){"use strict";var i=n(10),r=n(11),o=n(14);e._lib=i.extend({Events:o.Events},r,i)},function(e,n){e.exports=t},function(t,e,n){"use strict";var i=n(12),r=n(13),o=i||r,a={};o?(a.onready=function(t){o(t)},a.onload=function(t){o(window).on("load",t)},a.querySelector=function(t){o(t).slice(0)},a.data=function(t,e,n){return 2===arguments.length?o(t).data(e):3===arguments.length?o(t).data(e,n):void 0}):(a.onready=function(t){document.addEventListener("DOMContentLoaded",t,!1)},a.onload=function(t){addEventListener("load",t,!1)},a.querySelector=function(t){document.querySelectorAll(t)},a.data=function(t,e,n){return t.dataset||(e=e.replace(/([A-Z])/g,function(t){return"-"+t.toLocaleLowerCase()})),2===arguments.length?t.dataset?t.dataset[e]:t.getAttribute(e):void(3===arguments.length&&(t.dataset?t.dataset[e]=n:t.setAttribute(e,n)))}),e.onready=a.onready,e.onload=a.onload,e.querySelector=a.querySelector,e.data=a.data},function(t,n){t.exports=e},function(t,e){t.exports=n},function(t,e,n){"use strict";var i=n(10),r=n(15),o={};if(e.Events=o,r)e.Events=o=r.Events;else{var a=/\s+/,s=function(t,e,n,r,o){var c,l=0;if(n&&"object"==typeof n){void 0!==r&&"context"in o&&void 0===o.context&&(o.context=r);for(c=i.keys(n);l<c.length;l++)e=s(t,e,c[l],n[c[l]],o)}else if(n&&a.test(n))for(c=n.split(a);l<c.length;l++)e=t(e,c[l],r,o);else e=t(e,n,r,o);return e};o.on=function(t,e,n){return c(this,t,e,n)};var c=function(t,e,n,i,r){if(t._events=s(l,t._events||{},e,n,{context:i,ctx:t,listening:r}),r){var o=t._listeners||(t._listeners={});o[r.id]=r}return t};o.listenTo=function(t,e,n){if(!t)return this;var r=t._listenId||(t._listenId=i.uniqueId("l")),o=this._listeningTo||(this._listeningTo={}),a=o[r];if(!a){var s=this._listenId||(this._listenId=i.uniqueId("l"));a=o[r]={obj:t,objId:r,id:s,listeningTo:o,count:0}}return c(t,e,n,this,a),this};var l=function(t,e,n,i){if(n){var r=t[e]||(t[e]=[]),o=i.context,a=i.ctx,s=i.listening;s&&s.count++,r.push({callback:n,context:o,ctx:o||a,listening:s})}return t};o.off=function(t,e,n){return this._events?(this._events=s(u,this._events,t,e,{context:n,listeners:this._listeners}),this):this},o.stopListening=function(t,e,n){var r=this._listeningTo;if(!r)return this;for(var o=t?[t._listenId]:i.keys(r),a=0;a<o.length;a++){var s=r[o[a]];if(!s)break;s.obj.off(e,n,this)}return i.isEmpty(r)&&(this._listeningTo=void 0),this};var u=function(t,e,n,r){if(t){var o,a=0,s=r.context,c=r.listeners;if(e||n||s){for(var l=e?[e]:i.keys(t);a<l.length;a++){e=l[a];var u=t[e];if(!u)break;for(var p=[],f=0;f<u.length;f++){var d=u[f];n&&n!==d.callback&&n!==d.callback._callback||s&&s!==d.context?p.push(d):(o=d.listening,o&&0===--o.count&&(delete c[o.id],delete o.listeningTo[o.objId]))}p.length?t[e]=p:delete t[e]}return i.size(t)?t:void 0}for(var h=i.keys(c);a<h.length;a++)o=c[h[a]],delete c[o.id],delete o.listeningTo[o.objId]}};o.once=function(t,e,n){var r=s(p,{},t,e,i.bind(this.off,this));return this.on(r,void 0,n)},o.listenToOnce=function(t,e,n){var r=s(p,{},e,n,i.bind(this.stopListening,this,t));return this.listenTo(t,r)};var p=function(t,e,n,r){if(n){var o=t[e]=i.once(function(){r(e,o),n.apply(this,arguments)});o._callback=n}return t};o.trigger=function(t){if(!this._events)return this;for(var e=Math.max(0,arguments.length-1),n=Array(e),i=0;i<e;i++)n[i]=arguments[i+1];return s(f,this._events,t,void 0,n),this};var f=function(t,e,n,i){if(t){var r=t[e],o=t.all;r&&o&&(o=o.slice()),r&&d(r,i),o&&d(o,[e].concat(i))}return t},d=function(t,e){var n,i=-1,r=t.length,o=e[0],a=e[1],s=e[2];switch(e.length){case 0:for(;++i<r;)(n=t[i]).callback.call(n.ctx);return;case 1:for(;++i<r;)(n=t[i]).callback.call(n.ctx,o);return;case 2:for(;++i<r;)(n=t[i]).callback.call(n.ctx,o,a);return;case 3:for(;++i<r;)(n=t[i]).callback.call(n.ctx,o,a,s);return;default:for(;++i<r;)(n=t[i]).callback.apply(n.ctx,e);return}};o.bind=o.on,o.unbind=o.off}},function(t,e){t.exports=i},function(t,e){"use strict";!function(t){t[t.App=0]="App",t[t.Block=1]="Block",t[t.Service=2]="Service"}(e.RegType||(e.RegType={}));var n=e.RegType;e.getComponent=function(t){return function(e,i,r){return void 0===r&&(r=!1),function(o){var a=o;r||(a=new o);var s="";switch(i){case n.App:s="app";break;case n.Block:s="block";break;case n.Service:s="service"}s&&t[s](e,a)}}}}])});