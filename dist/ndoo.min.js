!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("_"),require("jQuery"),require("Zepto"),require("Backbone")):"function"==typeof define&&define.amd?define(["_","jQuery","Zepto","Backbone"],e):"object"==typeof exports?exports.ndoo=e(require("_"),require("jQuery"),require("Zepto"),require("Backbone")):t.ndoo=e(t._,t.jQuery,t.Zepto,t.Backbone)}(this,function(t,e,n,r){return function(t){function e(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return t[r].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){t.exports=n(1)},function(t,e,n){"use strict";var r=n(2);t.exports=new r.Ndoo},function(t,e,n){"use strict";var r=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},i=n(3),o=n(7),a=n(8),s=n(9),c=n(6),l=c.getPrepData(),u=function(t){function e(){var e=t.call(this)||this;return e._lib=s._lib,e.pageId="",e._pk=+new Date,e.storage=o.Storage,e.router=a.Router,e._loader={app:"do",block:"do",init:"do",appLoader:null,blockLoader:null,initLoader:null,doLoader:function(t,e){Do.apply(null,t.concat(e))},seajsLoader:function(t,e){seajs.use(t,e)}},e._blockData={_block:{},_app:{},_service:{},_exist:{}},e.storage._lib=e._lib,e._rebuildEvent(),e.event.init(),e.trigger("STATUS:NAPP_DEFINE"),e.trigger("STATUS:NBLOCK_DEFINE"),e.trigger("STATUS:NSERVICE_DEFINE"),e._bindBlockEvent(),l&&c.removePrepData(),e}return r(e,t),e.prototype.initPageId=function(t){if(!this.pageId&&"undefined"!=typeof document){var e=document.getElementById(t||"scriptArea");e&&(this.pageId=e.getAttribute("data-page-id")||""),!this.pageId&&t&&(this.pageId=t)}},e.prototype.getPk=function(t){return void 0===t&&(t=""),""+t+ ++this._pk},e.prototype.setLoader=function(t,e){this._loader[t]=t+"Loader",this._loader[t+"Loader"]=e},e.prototype.require=function(t,e,n){if(n=n.toLowerCase(),!this._loader[n+"Loader"])throw new Error("require load is not define");this[n](t,e)},e.prototype._block=function(t,e,n,r){var i,o;if("block"!=t&&"app"!=t&&"service"!=t)return!1;i=this._blockData["_"+t],o=e?e.replace(/^[\/.]|[\/.]$/g,"").split(/[\/.]/):[];var a,s,c=i;if(r||arguments.length>3){for(var l=0,u=o;l<u.length;l++){var p=u[l];c=c[p]||(c[p]={})}return!r||"app"!==t&&"block"!==t?"service"==t?(a=c[n]=r,s=!0):a=!1:a="object"==typeof r?"app"===t&&c[n]?this._lib.defaults(c[n],r):c[n]=r:"function"==typeof r&&(c[n]=r),(a||s)&&(e?this._blockData._exist[t+"."+e+"."+n]=!0:this._blockData._exist[t+"."+n]=!0),a}for(var f=0,d=o;f<d.length;f++){var v=d[f];if(!this._lib.has(c,v))return;c=c[v]}return c[n]},e.prototype.hasApp=function(t){return this._blockData._exist["app."+t]},e.prototype.setApp=function(t){return this._blockData._exist["app."+t]=!0},e.prototype.app=function(t,e){var n,r=t.match(/(.*?)(?:[\/.]([^\/.]+))$/);return r||(r=[,null,t]),t=r[1],n=r[2],arguments.length>1?this._block("app",t,n,e):this._block("app",t,n)},e.prototype._blockExist=function(t,e){void 0===e&&(e=!1);var n,r=t.match(/(.*?)(?:[\/.]([^\/.]+))$/);return r||(r=[,"_default",t]),t=r[1],n=r[2],e?this._blockData._exist["block."+t+"."+n]=!0:this._blockData._exist["block."+t+"."+n]},e.prototype.hasBlock=function(t){return this._blockExist(t)},e.prototype.setBlock=function(t){return this._blockExist(t,!0)},e.prototype.block=function(t,e){var n,r=t.match(/(.*?)(?:[\/.]([^\/.]+))$/);return r||(r=[,"default",t]),t=r[0],n=r[1],arguments.length>1?this._block("block",t,n,e):this._block("block",t,n)},e.prototype.initBlock=function(t){var e=this,n=this,r=n._lib,i=n.router,o=r.data(t,"nblockId");o=o.split(/\s*,\s*|\s+/);var a=function(n){i.parse(/^(?:\/?)(.*?)(?:\/?([^\/?#]+))(?:\?(.*?))?(?:\#(.*?))?$/,n,function(n,r,i){n=n.replace(/\//g,".");var o=n+"."+r;e.block(o)?e.trigger("NBLOCK_LOADED",t,n,r,i):e.hasBlock(o)&&e.require([n+"."+r],function(){e.trigger("NBLOCK_LOADED",t,n,r,i)},e._loader.block)})};r.each(o,function(t){var n=e;a.call(n,t)})},e.prototype._bindBlockEvent=function(){var t=this;this.on("NBLOCK_LOADED",function(e,n,r,i){null==n&&(n="_default");var o=t.block(n+"."+r);if(o)if(t._lib.isFunction(o.init)){var a=function(){o.init(e,i)};o.depend?t.require([].concat(o.depend),a,t._loader.block):a()}else t._lib.isFunction(o)&&o(e,i)}),this.on("NBLOCK_INIT",function(){var e=t._lib.querySelector("[data-nblock-id]");if(e&&e.length){for(var n=[],r=0,i=e;r<i.length;r++){var o=i[r],a=t._lib.data(o,"nblockAuto"),s=parseInt(t._lib.data(o,"nblockLevel"))||5;n.push([s,a,o])}n=n.sort(function(t,e){return t[0]-e[0]});for(var c=0,l=n;c<l.length;c++){var u=l[c],a=u[1],p=u[2];void 0!==a&&"false"==a.toString()||t.initBlock(p)}}})},e.prototype.service=function(t,e){var n,r=t.match(/(.*?)(?:[\/.]([^\/.]+))$/);return r||(r=[,"_default",t]),t=r[1],n=r[2],arguments.length>1?this._block("service",t,n,e):(e=this._block("service",t,n),e&&this._lib.isFunction(e.init)?e.init():e)},e.prototype.dispatch=function(){var t=this,e=this._lib,n=function(e,n,r,i){var o,a=t._lib;if("before"===e?o=n.before:"after"===e&&(o=n.after),o){var s;"object"==typeof o&&(s=[].concat(o));for(var c=0,l=s;c<l.length;c++){var u=l[c],p=u.filter;a.isArray(p)||(p=[].concat(p.split(/\s*,\s*|\s+/)));var f=!0;if(u.only){var d=u.only;a.isArray(d)||(d=[].concat(d.split(/\s*,\s*|\s+/))),a.indexOf(d,r)<0&&(f=!1)}else if(u.except){var v=u.except;a.isArray(v)||(v=[].concat(v.split(/\s*,\s*|\s+/))),a.indexOf(v,r)>-1&&(f=!1)}if(f)for(var h=0,_=p;h<_.length;h++){var g=_[h];n[g+"Filter"](r,i)}}}};this.on("NAPP_ACTION_BEFORE",function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return n.apply(null,["before"].concat(t))}),this.on("NAPP_ACTION_AFTER",function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return n.apply(null,["after"].concat(t))}),this.on("NAPP_LOADED",function(n,r,i,o){var a,s=t;a=n?t.app(n+"."+r):t.app(r),!e.has(a,i+"Action")&&e.has(a,"emptyAction")&&(i="_empty");var c=[];a.depend&&(c=c.concat(a.depend)),a[i+"Depend"]&&(c=c.concat(a[i+"Depend"]));var l=r;n&&(l=(n+"."+r).replace(/\./g,"_")),l=l.toUpperCase();var u=function(){var t=[].slice.call(arguments,0);t.unshift(o),i&&(s.trigger("NAPP_ACTION_BEFORE",a,i,o),s.trigger("NAPP_"+l+"_ACTION_BEFORE",a,i,o),a[i+"Before"]&&a[i+"Before"].apply(a,t),a[i+"Action"]&&a[i+"Action"].apply(a,t),a[i+"After"]&&a[i+"After"].apply(a,t),s.trigger("NAPP_"+l+"_ACTION_AFTER",a,i,o),s.trigger("NAPP_ACTION_AFTER",a,i,o)),s.trigger("STATUS:NBLOCK_INIT")};c.length?t.require(e.uniq(c),u,t._loader.app):u()}),this.on("PAGE_STATUS_ROUTING",function(e){t.router.parse(/^(?:\/?)(.*?)(?:\/?([^\/?#]+))(?:\?(.*?))?(?:\#(.*?))?$/,e,function(e,n,r){var i=e.match(/(.*?)(?:[\/.]([^\/.]+))$/),o="";i&&(o=i[1],e=i[2]);var a;o?(o=o.replace(/\//g,"."),a=o+"."+e):a=e,t.app(a)?t.trigger("NAPP_LOADED",o,e,n,r):t.hasApp(a)?t.require([a],function(){this.trigger("NAPP_LOADED",o,e,n,r)},t._loader.app):t.trigger("STATUS:NBLOCK_INIT")})})},e.prototype.triggerPageStatus=function(t){var e=this,n=this._lib,r=function(){e.trigger("STATUS:PAGE_STATUS_FAST"),n.onready(function(){e.trigger("STATUS:PAGE_STATUS_DOMPREP"),e.trigger("STATUS:PAGE_STATUS_DOM"),e.trigger("STATUS:PAGE_STATUS_DOMORLOAD")}),n.onload(function(){e.trigger("STATUS:PAGE_STATUS_LOAD")}),e.on("PAGE_STATUS_DOM",function(){e.pageId&&e.trigger("STATUS:PAGE_STATUS_ROUTING",e.pageId)})};t?this.require([].concat(t),r,this._loader.init):r()},e.prototype.init=function(t,e){var n=this._lib;return n.isArray(t)&&(r=["",t],t=r[0],e=r[1]),this.initPageId(t),this.dispatch(),this.triggerPageStatus(e),this;var r},e.prototype._rebuildEvent=function(){var t=this._lib,e=t.extend({events:{},listened:{}},t.Events);this.event=t.extend(this.event,{eventHandle:e,on:function(e,n){var r=this.eventHandle;if(r.on(e,n),r.listened[e]=!0,t.has(r.events,"STATUS:"+e)&&n.apply(r,r.events["STATUS:"+e]),t.has(r.events,e))for(var i=0,o=r.events[e];i<o.length;i++){var a=o[i];n.apply(r,a)}},trigger:function(e,n,r){var i=this.eventHandle;"DEFAULT"===n?i.trigger.apply(i,[e].concat(r)):"DELAY"===n?(t.has(i.listened,e)&&i.trigger.apply(i,[e].concat(r)),t.has(i.events,e)||(i.events[e]=[]),i.events[e].push(r)):"STATUS"===n&&(t.has(i.events,n+":"+e)||(i.events[n+":"+e]=r,t.has(i.listened,e)&&i.trigger.apply(i,[e].concat(r))))},off:function(t){var e=this.eventHandle;e.off(t),delete e.listened[t],delete e.events[t]},init:function(){var t=this,e=t.inited,n=t._temp,r=t.TYPE_ON,i=t.TYPE_TRIGGER;if(!e&&n.length){for(var o=0,a=n;o<a.length;o++){var s=a[o];s.type===r?this.on(s.eventName,s.callback):s.type===i&&this.trigger(s.eventName,s.eventTYpe,s.data)}e=!0}}})},e}(i.Prep);e.Ndoo=u},function(t,e,n){"use strict";var r=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},i=n(4),o=n(5),a=n(6),s=a.getPrepData(),c=function(t){function e(){var e=t.call(this)||this;return e.event=o.EventBasic,e.vars={},e.func={},e._lib={},s&&(e.vars=s.vars,e.func=s.func),e}return r(e,t),e}(i.EventApi);e.Prep=c},function(t,e){"use strict";var n=function(){function t(){}return t.prototype.on=function(t,e){t=t.split(/\s*,\s*|\s+/);for(var n=0,r=t;n<r.length;n++){var i=r[n];this.event.on(i,e)}},t.prototype.trigger=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var r=t.indexOf(":"),i=t.substring(0,r++)||"DEFAULT",o=t.substring(r);this.event.trigger(o,i,e)},t.prototype.off=function(t){t=t.split(/\s*,\s*|\s+/);for(var e=0,n=t;e<n.length;e++){var r=n[e];this.event.off(r)}},t}();e.EventApi=n},function(t,e,n){"use strict";var r=n(6),i=r.getPrepData(),o=function(){function t(t,e){return"#"+t+":#"+e}return t.on=function(t,e){this._temp.push({type:this.TYPE_ON,eventName:t,callback:e})},t.trigger=function(t,e,n){this._temp.push({type:this.TYPE_TRIGGER,eventName:t,eventType:e,data:n})},t.off=function(t){},t.init=function(){},t}();o.TYPE_ON=1,o.TYPE_TRIGGER=2,o.inited=!1,o._temp=i?i.eventData:[],e.EventBasic=o},function(t,e){"use strict";e.getPrepData=function(){return!("undefined"==typeof window||!window.ndoo_prep_data)&&window.ndoo_prep_data},e.setPrepData=function(){var t={};"undefined"!=typeof window&&(t=window),t.ndoo_prep_data||(t.ndoo_prep_data={eventData:[],func:{},vars:{}})},e.removePrepData=function(){"undefined"!=typeof window&&window.ndoo_prep_data&&delete window.ndoo_prep_data}},function(t,e){"use strict";var n=function(){function t(e,n,r){var i=t,o=r&i.DESTROY,a=r&i.REWRITE,s=i._data;return void 0===n?s[e]:o?(delete s[e],!0):!(!a&&i._lib.has(s,e))&&(s[e]=n)}return t}();n._data={},n.REWRITE=1,n.DESTROY=2,e.Storage=n},function(t,e){"use strict";var n=function(){function t(){}return t.parse=function(t,e,n){var r=t.exec(e);null!=r&&n.apply(null,r.slice(1))},t}();e.Router=n},function(t,e,n){"use strict";var r=n(10),i=n(11),o=n(14);e._lib=r.extend({Events:o.Events},i,r)},function(e,n){e.exports=t},function(t,e,n){"use strict";var r=n(12),i=n(13),o=r||i,a={};o?(a.onready=function(t){o(t)},a.onload=function(t){o(window).on("load",t)},a.querySelector=function(t){o(t).slice(0)},a.data=function(t,e,n){return 2===arguments.length?o(t).data(e):3===arguments.length?o(t).data(e,n):void 0}):(a.onready=function(t){document.addEventListener("DOMContentLoaded",t,!1)},a.onload=function(t){addEventListener("load",t,!1)},a.querySelector=function(t){document.querySelectorAll(t)},a.data=function(t,e,n){return t.dataset||(e=e.replace(/([A-Z])/g,function(t){return"-"+t.toLocaleLowerCase()})),2===arguments.length?t.dataset?t.dataset[e]:t.getAttribute(e):void(3===arguments.length&&(t.dataset?t.dataset[e]=n:t.setAttribute(e,n)))}),e.onready=a.onready,e.onload=a.onload,e.querySelector=a.querySelector,e.data=a.data},function(t,n){t.exports=e},function(t,e){t.exports=n},function(t,e,n){"use strict";var r=n(10),i=n(15),o={};if(e.Events=o,i)e.Events=o=i.Events;else{var a=/\s+/,s=function(t,e,n,i,o){var c,l=0;if(n&&"object"==typeof n){void 0!==i&&"context"in o&&void 0===o.context&&(o.context=i);for(c=r.keys(n);l<c.length;l++)e=s(t,e,c[l],n[c[l]],o)}else if(n&&a.test(n))for(c=n.split(a);l<c.length;l++)e=t(e,c[l],i,o);else e=t(e,n,i,o);return e};o.on=function(t,e,n){return c(this,t,e,n)};var c=function(t,e,n,r,i){if(t._events=s(l,t._events||{},e,n,{context:r,ctx:t,listening:i}),i){var o=t._listeners||(t._listeners={});o[i.id]=i}return t};o.listenTo=function(t,e,n){if(!t)return this;var i=t._listenId||(t._listenId=r.uniqueId("l")),o=this._listeningTo||(this._listeningTo={}),a=o[i];if(!a){var s=this._listenId||(this._listenId=r.uniqueId("l"));a=o[i]={obj:t,objId:i,id:s,listeningTo:o,count:0}}return c(t,e,n,this,a),this};var l=function(t,e,n,r){if(n){var i=t[e]||(t[e]=[]),o=r.context,a=r.ctx,s=r.listening;s&&s.count++,i.push({callback:n,context:o,ctx:o||a,listening:s})}return t};o.off=function(t,e,n){return this._events?(this._events=s(u,this._events,t,e,{context:n,listeners:this._listeners}),this):this},o.stopListening=function(t,e,n){var i=this._listeningTo;if(!i)return this;for(var o=t?[t._listenId]:r.keys(i),a=0;a<o.length;a++){var s=i[o[a]];if(!s)break;s.obj.off(e,n,this)}return r.isEmpty(i)&&(this._listeningTo=void 0),this};var u=function(t,e,n,i){if(t){var o,a=0,s=i.context,c=i.listeners;if(e||n||s){for(var l=e?[e]:r.keys(t);a<l.length;a++){e=l[a];var u=t[e];if(!u)break;for(var p=[],f=0;f<u.length;f++){var d=u[f];n&&n!==d.callback&&n!==d.callback._callback||s&&s!==d.context?p.push(d):(o=d.listening,o&&0===--o.count&&(delete c[o.id],delete o.listeningTo[o.objId]))}p.length?t[e]=p:delete t[e]}return r.size(t)?t:void 0}for(var v=r.keys(c);a<v.length;a++)o=c[v[a]],delete c[o.id],delete o.listeningTo[o.objId]}};o.once=function(t,e,n){var i=s(p,{},t,e,r.bind(this.off,this));return this.on(i,void 0,n)},o.listenToOnce=function(t,e,n){var i=s(p,{},e,n,r.bind(this.stopListening,this,t));return this.listenTo(t,i)};var p=function(t,e,n,i){if(n){var o=t[e]=r.once(function(){i(e,o),n.apply(this,arguments)});o._callback=n}return t};o.trigger=function(t){if(!this._events)return this;for(var e=Math.max(0,arguments.length-1),n=Array(e),r=0;r<e;r++)n[r]=arguments[r+1];return s(f,this._events,t,void 0,n),this};var f=function(t,e,n,r){if(t){var i=t[e],o=t.all;i&&o&&(o=o.slice()),i&&d(i,r),o&&d(o,[e].concat(r))}return t},d=function(t,e){var n,r=-1,i=t.length,o=e[0],a=e[1],s=e[2];switch(e.length){case 0:for(;++r<i;)(n=t[r]).callback.call(n.ctx);return;case 1:for(;++r<i;)(n=t[r]).callback.call(n.ctx,o);return;case 2:for(;++r<i;)(n=t[r]).callback.call(n.ctx,o,a);return;case 3:for(;++r<i;)(n=t[r]).callback.call(n.ctx,o,a,s);return;default:for(;++r<i;)(n=t[r]).callback.apply(n.ctx,e);return}};o.bind=o.on,o.unbind=o.off}},function(t,e){t.exports=r}])});
//# sourceMappingURL=ndoo.min.js.map