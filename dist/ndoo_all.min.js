(function(){"use strict";var _n;this.ndoo||(this.N=this.ndoo||(this.ndoo={}),_n=this.ndoo,_n._isDebug=0,_n.event=function(name,type){return type+":"+name},function(e){null==e&&(e=_n.event),e.TYPE_ON=1,e.TYPE_TRIGGER=2,e.inited=!1,e._temp=[],e.on=function(eventName,callback){this._temp.push({type:this.TYPE_ON,eventName:eventName,callback:callback})},e.trigger=function(eventName,eventType,data){this._temp.push({type:this.TYPE_TRIGGER,eventName:eventName,eventType:eventType,data:data})},e.off=function(){}}(),_n.on=function(eventName,callback){var i$,len$,name,results$=[];for(eventName=eventName.split(/\s*,\s*|\s+/),i$=0,len$=eventName.length;len$>i$;++i$)name=eventName[i$],results$.push(this.event.on(name,callback));return results$},_n.trigger=function(eventName){var data,res$,i$,to$,_index,type,name;for(res$=[],i$=1,to$=arguments.length;to$>i$;++i$)res$.push(arguments[i$]);return data=res$,_index=eventName.indexOf(":"),type=eventName.substring(0,_index++),type||(type="DEFAULT"),name=eventName.substring(_index),this.event.trigger(name,type,data)},_n.off=function(eventName){var i$,len$,name,results$=[];for(eventName=eventName.split(/\s*,\s*|\s+/),i$=0,len$=eventName.length;len$>i$;++i$)name=eventName[i$],results$.push(this.event.off(name));return results$},_n.vars||(_n.vars={}),_n.func||(_n.func={}),_n._lib||(_n._lib={}))}).call(this),function(){"use strict";var _,_n,_lib,$;_=this._,this.N=this.ndoo||(this.ndoo={}),_n=this.ndoo,_lib=_n._lib,$=this.jQuery||this.Zepto,_.extend(_lib,_),_lib.extend(_lib,{onready:function(callback){$?$(callback):window.addEventListener&&document.addEventListener("DOMContentLoaded",callback,!1)},onload:function(callback){$?$(window).on("load",callback):window.addEventListener&&addEventListener("load",callback,!1)},querySelector:function(selector){return $?$(selector).slice(0):document.querySelectorAll?document.querySelectorAll(selector):void 0},data:function(elem,key,value){var type;if(type=arguments.length,$){if(2===type)return $(elem).data(key);if(3===type)return $(elem).data(key,value)}else{if(elem.dataset||(key=key.replace(/([A-Z])/g,function(char){return"-"+char.toLowerCase()})),2===type)return elem.dataset?elem.dataset[key]:elem.getAttribute(key);if(3===type)return elem.dataset?elem.dataset[key]=value:elem.setAttribute(key,value)}}})}.call(this),function(){"use strict";var _n,_lib,array,slice;if(this.N=this.ndoo||(this.ndoo={}),_n=this.ndoo,_lib=_n._lib,this.Backbone)return void(_lib.Events=this.Backbone.Events);array=[],slice=array.slice;var Events=_lib.Events={},eventSplitter=/\s+/,eventsApi=function(iteratee,events,name,callback,opts){var names,i=0;if(name&&"object"==typeof name){void 0!==callback&&"context"in opts&&void 0===opts.context&&(opts.context=callback);for(names=_lib.keys(name);i<names.length;i++)events=eventsApi(iteratee,events,names[i],name[names[i]],opts)}else if(name&&eventSplitter.test(name))for(names=name.split(eventSplitter);i<names.length;i++)events=iteratee(events,names[i],callback,opts);else events=iteratee(events,name,callback,opts);return events};Events.on=function(name,callback,context){return internalOn(this,name,callback,context)};var internalOn=function(obj,name,callback,context,listening){if(obj._events=eventsApi(onApi,obj._events||{},name,callback,{context:context,ctx:obj,listening:listening}),listening){var listeners=obj._listeners||(obj._listeners={});listeners[listening.id]=listening}return obj};Events.listenTo=function(obj,name,callback){if(!obj)return this;var id=obj._listenId||(obj._listenId=_lib.uniqueId("l")),listeningTo=this._listeningTo||(this._listeningTo={}),listening=listeningTo[id];if(!listening){var thisId=this._listenId||(this._listenId=_lib.uniqueId("l"));listening=listeningTo[id]={obj:obj,objId:id,id:thisId,listeningTo:listeningTo,count:0}}return internalOn(obj,name,callback,this,listening),this};var onApi=function(events,name,callback,options){if(callback){var handlers=events[name]||(events[name]=[]),context=options.context,ctx=options.ctx,listening=options.listening;listening&&listening.count++,handlers.push({callback:callback,context:context,ctx:context||ctx,listening:listening})}return events};Events.off=function(name,callback,context){return this._events?(this._events=eventsApi(offApi,this._events,name,callback,{context:context,listeners:this._listeners}),this):this},Events.stopListening=function(obj,name,callback){var listeningTo=this._listeningTo;if(!listeningTo)return this;for(var ids=obj?[obj._listenId]:_lib.keys(listeningTo),i=0;i<ids.length;i++){var listening=listeningTo[ids[i]];if(!listening)break;listening.obj.off(name,callback,this)}return _lib.isEmpty(listeningTo)&&(this._listeningTo=void 0),this};var offApi=function(events,name,callback,options){if(events){var listening,i=0,context=options.context,listeners=options.listeners;if(name||callback||context){for(var names=name?[name]:_lib.keys(events);i<names.length;i++){name=names[i];var handlers=events[name];if(!handlers)break;for(var remaining=[],j=0;j<handlers.length;j++){var handler=handlers[j];callback&&callback!==handler.callback&&callback!==handler.callback._callback||context&&context!==handler.context?remaining.push(handler):(listening=handler.listening,listening&&0===--listening.count&&(delete listeners[listening.id],delete listening.listeningTo[listening.objId]))}remaining.length?events[name]=remaining:delete events[name]}return _lib.size(events)?events:void 0}for(var ids=_lib.keys(listeners);i<ids.length;i++)listening=listeners[ids[i]],delete listeners[listening.id],delete listening.listeningTo[listening.objId]}};Events.once=function(name,callback,context){var events=eventsApi(onceMap,{},name,callback,_lib.bind(this.off,this));return this.on(events,void 0,context)},Events.listenToOnce=function(obj,name,callback){var events=eventsApi(onceMap,{},name,callback,_lib.bind(this.stopListening,this,obj));return this.listenTo(obj,events)};var onceMap=function(map,name,callback,offer){if(callback){var once=map[name]=_lib.once(function(){offer(name,once),callback.apply(this,arguments)});once._callback=callback}return map};Events.trigger=function(name){if(!this._events)return this;for(var length=Math.max(0,arguments.length-1),args=Array(length),i=0;length>i;i++)args[i]=arguments[i+1];return eventsApi(triggerApi,this._events,name,void 0,args),this};var triggerApi=function(objEvents,name,cb,args){if(objEvents){var events=objEvents[name],allEvents=objEvents.all;events&&allEvents&&(allEvents=allEvents.slice()),events&&triggerEvents(events,args),allEvents&&triggerEvents(allEvents,[name].concat(args))}return objEvents},triggerEvents=function(events,args){var ev,i=-1,l=events.length,a1=args[0],a2=args[1],a3=args[2];switch(args.length){case 0:for(;++i<l;)(ev=events[i]).callback.call(ev.ctx);return;case 1:for(;++i<l;)(ev=events[i]).callback.call(ev.ctx,a1);return;case 2:for(;++i<l;)(ev=events[i]).callback.call(ev.ctx,a1,a2);return;case 3:for(;++i<l;)(ev=events[i]).callback.call(ev.ctx,a1,a2,a3);return;default:for(;++i<l;)(ev=events[i]).callback.apply(ev.ctx,args);return}};Events.bind=Events.on,Events.unbind=Events.off}.call(this),function(){"use strict";var _n,_lib,_stor;this.N=this.ndoo||(this.ndoo={}),_n=this.ndoo,_lib=_n._lib,!_n._lib.Events&&this.Backbone&&(_n._lib.Events=this.Backbone),_n.storage=function(key,value,option){var destroy,rewrite,data;return destroy=option&_n.storage.DESTROY,rewrite=option&_n.storage.REWRITE,data=_n.storage._data,void 0===value?data[key]:destroy?(delete data[key],!0):!rewrite&&_lib.has(data,key)?!1:(data[key]=value,data[key])},_stor=_n.storage,_n.storage._data={},_n.storage.REWRITE=1,_n.storage.DESTROY=2,_n.require=function(depend,callback,type){var loader;null==type&&(type="loader"),"do"===type.toLowerCase()?Do.apply(null,depend.concat(callback)):"seajs"===type.toLowerCase()?seajs.use(depend,callback):(loader=_n._loader[type],loader&&loader(depend,callback))},_n._loader={app:"",block:""},_n.setLoader=function(type,loader){return"app"===type?(_n._loader.app="appLoader",_n._loader.appLoader=loader):"block"===type?(_n._loader.block="blockLoader",_n._loader.blockLoader=loader):void 0},_n._blockData||(_n._blockData={_block:{},_app:{},_service:{},_exist:{}}),_n._block=function(base,namespace,name,block){var data,nsArr,temp,i$,len$,ns,result,success;if("block"!==base&&"app"!==base&&"service"!==base)return!1;if(data=_n._blockData["_"+base],nsArr=namespace?namespace.replace(/^[\/.]|[\/.]$/g,"").split(/[\/.]/):[],temp=data,block||arguments.length>3){for(i$=0,len$=nsArr.length;len$>i$;++i$)ns=nsArr[i$],temp=temp[ns]||(temp[ns]={});return!block||"app"!==base&&"block"!==base?"service"===base?(result=temp[name]=block,success=!0):result=!1:result="object"==typeof block?"app"===base&&temp[name]?_lib.defaults(temp[name],block):temp[name]=block:"function"==typeof block?temp[name]=block:!1,(result||success)&&(namespace?_n._blockData._exist[base+"."+namespace+"."+name]=!0:_n._blockData._exist[base+"."+name]=!0),result}for(i$=0,len$=nsArr.length;len$>i$;++i$){if(ns=nsArr[i$],!_lib.has(temp,ns))return void 0;temp=temp[ns]}return temp[name]},_n.hasApp=function(namespace){return _n._blockData._exist["app."+namespace]},_n.setApp=function(namespace){return _n._blockData._exist["app."+namespace]=!0},_n.app=function(namespace,controller){var nsmatch,controllerName,ref$;return(nsmatch=namespace.match(/(.*?)(?:[\/.]([^\/.]+))$/))?(namespace=nsmatch[1],controllerName=nsmatch[2]):(ref$=[namespace,null],controllerName=ref$[0],namespace=ref$[1]),arguments.length>1?_n._block("app",namespace,controllerName,controller):_n._block("app",namespace,controllerName)},_n.trigger("STATUS:NAPP_DEFINE"),_n.event=_lib.extend(_n.event,{eventHandle:_lib.extend({events:{},listened:{}},_n._lib.Events),on:function(eventName,callback){var eventHandle,i$,ref$,len$,item;if(eventHandle=this.eventHandle,eventHandle.on(eventName,callback),eventHandle.listened[eventName]=!0,_lib.has(eventHandle.events,"STATUS:"+eventName)&&callback.apply(eventHandle,eventHandle.events["STATUS:"+eventName]),_lib.has(eventHandle.events,eventName))for(i$=0,len$=(ref$=eventHandle.events[eventName]).length;len$>i$;++i$)item=ref$[i$],callback.apply(eventHandle,item)},off:function(eventName){var eventHandle;eventHandle=this.eventHandle,eventHandle.off(eventName),delete eventHandle.listened[eventName],delete eventHandle.events[eventName]},trigger:function(eventName,eventType,data){var eventHandle;eventHandle=this.eventHandle,"DEFAULT"===eventType?eventHandle.trigger.apply(eventHandle,[eventName].concat(data)):"DELAY"===eventType?(_lib.has(eventHandle.listened,eventName)&&eventHandle.trigger.apply(eventHandle,[eventName].concat(data)),_lib.has(eventHandle.events,eventName)||(eventHandle.events[eventName]=[]),eventHandle.events[eventName].push(data)):"STATUS"===eventType&&(_lib.has(eventHandle.events,eventType+":"+eventName)||(eventHandle.events[eventType+":"+eventName]=data,_lib.has(eventHandle.listened,eventName)&&eventHandle.trigger.apply(eventHandle,[eventName].concat(data))))},init:function(){var i$,ref$,len$,item;if(!this.inited)for(i$=0,len$=(ref$=this._temp).length;len$>i$;++i$)item=ref$[i$],item.type===this.TYPE_ON?this.on(item.eventName,item.callback):item.type===this.TYPE_TRIGGER&&this.trigger(item.eventName,item.eventType,item.data);this.inited=!0}}),_n.event.init(),_lib.extend(_n,{pageId:"",initPageId:function(id){var el;this.pageId||("undefined"!=typeof document&&(el=document.getElementById(id||"scriptArea"))&&(this.pageId=el.getAttribute("data-page-id")||""),!this.pageId&&id&&(this.pageId=id))},getPk:function(){var _pk;return _pk=+new Date,function(prefix){return null==prefix&&(prefix=""),prefix+ ++_pk}}(),router:{parse:function(route,url,callback){var routeMatch;routeMatch=route.exec(url),null!==routeMatch&&callback.apply(null,routeMatch.slice(1))}},dispatch:function(){var filterHaldner,this$=this;filterHaldner=function(type,controller,actionName,params){var data,_data,i$,len$,dataItem,_filter,isRun,_only,_except,j$,len1$,filter,key$;if("before"===type?data=controller.before:"after"===type&&(data=controller.after),data)for("object"==typeof data&&(_data=[].concat(data)),i$=0,len$=_data.length;len$>i$;++i$)if(dataItem=_data[i$],_filter=dataItem.filter,_lib.isArray(_filter)||(_filter=[].concat(_filter.split(/\s*,\s*|\s+/))),isRun=!0,dataItem.only?(_only=dataItem.only,_lib.isArray(_only)||(_only=[].concat(_only.split(/\s*,\s*|\s+/))),_lib.indexOf(_only,actionName)<0&&(isRun=!1)):dataItem.except&&(_except=dataItem.except,_lib.isArray(_except)||(_except=[].concat(_except.split(/\s*,\s*|\s+/))),_lib.indexOf(_except,actionName)>-1&&(isRun=!1)),isRun)for(j$=0,len1$=_filter.length;len1$>j$;++j$)filter=_filter[j$],"function"==typeof controller[key$=filter+"Filter"]&&controller[key$](actionName,params)},this.on("NAPP_ACTION_BEFORE",function(){var params,res$,i$,to$;for(res$=[],i$=0,to$=arguments.length;to$>i$;++i$)res$.push(arguments[i$]);return params=res$,filterHaldner.apply(null,["before"].concat(params))}),this.on("NAPP_ACTION_AFTER",function(){var params,res$,i$,to$;for(res$=[],i$=0,to$=arguments.length;to$>i$;++i$)res$.push(arguments[i$]);return params=res$,filterHaldner.apply(null,["after"].concat(params))}),this.on("NAPP_LOADED",function(namespace,controllerName,actionName,params){var controller,depend,filterPrefix,run,loader;controller=_n.app(namespace?namespace+"."+controllerName:controllerName),!_lib.has(controller,actionName+"Action")&&_lib.has(controller,"_emptyAction")&&(actionName="_empty"),depend=[],controller.depend&&(depend=depend.concat(controller.depend)),controller[actionName+"Depend"]&&(depend=depend.concat(controller[actionName+"Depend"])),filterPrefix=controllerName,namespace&&(filterPrefix=(namespace+"."+controllerName).replace(/\./g,"_")),filterPrefix=filterPrefix.toUpperCase(),run=function(){var args,ref$,ref1$,ref2$;args=[].slice.call(arguments,0),args=[params].concat(args),actionName&&(_n.trigger("NAPP_ACTION_BEFORE",controller,actionName,params),_n.trigger("NAPP_"+filterPrefix+"_ACTION_BEFORE",controller,actionName,params),null!=(ref$=controller[actionName+"Before"])&&ref$.apply(controller,args),null!=(ref1$=controller[actionName+"Action"])&&ref1$.apply(controller,args),null!=(ref2$=controller[actionName+"After"])&&ref2$.apply(controller,args),_n.trigger("NAPP_"+filterPrefix+"_ACTION_AFTER",controller,actionName,params),_n.trigger("NAPP_ACTION_AFTER",controller,actionName,params)),_n.trigger("STATUS:NBLOCK_INIT")},depend.length?(loader=controller.loader||_n._loader.app||"Do",_n.require(_lib.uniq(depend),run,loader)):run()}),this.on("PAGE_STATUS_ROUTING",function(data){this$.router.parse(/^(?:\/?)(.*?)(?:\/?([^\/?#]+))(?:\?(.*?))?(?:\#(.*?))?$/,data,function(controller,action,params){var nsmatch,namespace,pkg;(nsmatch=controller.match(/(.*?)(?:[\/.]([^\/.]+))$/))?(namespace=nsmatch[1],controller=nsmatch[2]):namespace=void 0,namespace?(namespace=namespace.replace(/\//g,"."),pkg=namespace+"."+controller):pkg=controller,_n.app(pkg)?this$.trigger("NAPP_LOADED",namespace,controller,action,params):_n.hasApp(pkg)?this$.require([pkg+""],function(){_n.trigger("NAPP_LOADED",namespace,controller,action,params)},"Do"):this$.trigger("STATUS:NBLOCK_INIT")})})},triggerPageStatus:function(depend){var call,this$=this;call=function(){this$.trigger("STATUS:PAGE_STATUS_FAST"),_lib.onready(function(){this$.trigger("STATUS:PAGE_STATUS_DOMPREP"),this$.trigger("STATUS:PAGE_STATUS_DOM"),this$.trigger("STATUS:PAGE_STATUS_DOMORLOAD")}),_lib.onload(function(){return this$.trigger("STATUS:PAGE_STATUS_LOAD")}),this$.on("PAGE_STATUS_DOM",function(){this$.pageId&&this$.trigger("STATUS:PAGE_STATUS_ROUTING",this$.pageId)})},depend?this.require([].concat(depend),call,"Do"):call()},init:function(id,depend){var ref$;return _lib.isArray(id)&&(ref$=["",id],id=ref$[0],depend=ref$[1]),this.initPageId(id),this.dispatch(),this.triggerPageStatus(depend),this}})}.call(this),function(){"use strict";var _n,_lib,_blockExist;this.N=this.ndoo||(this.ndoo={}),_n=this.ndoo,_lib=_n._lib,_blockExist=function(ns,set){var nsmatch,name;return nsmatch=ns.match(/(.*?)(?:[\/.]([^\/.]+))$/),nsmatch||(nsmatch=[void 0,"_default",ns]),ns=nsmatch[1],name=nsmatch[2],set?_n._blockData._exist["block."+ns+"."+name]=!0:_n._blockData._exist["block."+ns+"."+name]},_n.hasBlock=function(namespace){return _blockExist(namespace)},_n.setBlock=function(namespace){return _blockExist(namespace,!0)},_n.block=function(namespace,block){var nsmatch,name,ref$;return(nsmatch=namespace.match(/(.*?)(?:[\/.]([^\/.]+))$/))?(namespace=nsmatch[1],name=nsmatch[2]):(ref$=["_default",namespace],namespace=ref$[0],name=ref$[1]),arguments.length>1?_n._block("block",namespace,name,block):_n._block("block",namespace,name)},_n.trigger("STATUS:NBLOCK_DEFINE"),_n.on("NBLOCK_LOADED",function(elem,namespace,name,params){var block,call,loader;if(null==namespace&&(namespace="_default"),block=_n.block(namespace+"."+name)){if(_lib.isFunction(block.init))return call=function(){block.init(elem,params)},block.depend?(loader=block.loader||_n._loader.block||"Do",_n.require([].concat(block.depend),call,loader)):call();if(_lib.isFunction(block))return block(elem,params)}}),_n.initBlock=function(elem){var blockId,_call;blockId=_lib.data(elem,"nblockId"),blockId=blockId.split(/\s*,\s*|\s+/),_call=function(blockId){var this$=this;return this.router.parse(/^(?:\/?)(.*?)(?:\/?([^\/?#]+))(?:\?(.*?))?(?:\#(.*?))?$/,blockId,function(namespace,block,params){var pkg;null==namespace&&(namespace="_default"),namespace=namespace.replace(/\//g,"."),pkg=namespace+"."+block,this$.block(pkg)?this$.trigger("NBLOCK_LOADED",elem,namespace,block,params):_n.hasBlock(pkg)&&this$.require([namespace+"."+block],function(){_n.trigger("NBLOCK_LOADED",elem,namespace,block,params)},"Do")})},_lib.each(blockId,function(id){return _call.call(_n,id)})},_n.on("NBLOCK_INIT",function(){var blockEl,blocks,i$,len$,el,auto,level,item,block;if(blockEl=_lib.querySelector("[data-nblock-id]"),blockEl&&blockEl.length){for(blocks=[],i$=0,len$=blockEl.length;len$>i$;++i$)el=blockEl[i$],auto=_lib.data(el,"nblockAuto"),level=parseInt(_lib.data(el,"nblockLevel"))||5,blocks.push([level,auto,el]);for(blocks.sort(function(block1,block2){return block1[0]>block2[0]}),i$=0,len$=blocks.length;len$>i$;++i$)item=blocks[i$],auto=item[1],block=item[2],(void 0===auto||"false"!==auto.toString())&&_n.initBlock(block)}})}.call(this),function(){"use strict";var _n,_lib;this.N=this.ndoo||(this.ndoo={}),_n=this.ndoo,_lib=_n._lib,_n.service=function(namespace,service){var nsmatch,name,ref$;return(nsmatch=namespace.match(/(.*?)(?:[\/.]([^\/.]+))$/))?(namespace=nsmatch[1],name=nsmatch[2]):(ref$=["_default",namespace],namespace=ref$[0],name=ref$[1]),arguments.length>1?_n._block("service",namespace,name,service):(service=_n._block("service",namespace,name),service&&_lib.isFunction(service.init)?service.init(_n):service)},_n.trigger("STATUS:NSERVICE_DEFINE")}.call(this);